// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  // 账户id
  userID      String        @id @default(uuid())
  // 邮箱
  email       String        @unique
  password    String?
  // 命名空间
  namespace   String        @unique @default(uuid())
  // 显示名称
  displayName String?
  avatarURL   String?
  // 地区
  location    String        @default("us")
  // 账户类型
  type        String        @default("user")
  // 创建时间
  createdAt   DateTime      @default(now())
  AccessToken AccessToken[]
  Product     Product[]
  Order       Order[]
  Card        Card?
  Item        Item[]
}

model Item {
  id        String   @id @default(cuid())
  owner     User     @relation(fields: [ownerId], references: [userID])
  ownerId   String
  // 数量
  count     Int
  // 创建时间
  createdAt DateTime @default(now())
  product   Product? @relation(fields: [productID], references: [productID])
  // 产品
  productID String?
  // 其他数据
  data      String
}

model Card {
  user        User    @relation(fields: [userID], references: [userID])
  // 所有者id
  userID      String  @id
  product     Product @relation(fields: [productID], references: [productID])
  productID   String
  // 商品数据
  productData String?
  // 数量
  count       Int     @default(1)
  // 总金额
  total       Decimal @db.Decimal(10, 2)
}

model AccessToken {
  user      User      @relation(fields: [userID], references: [userID])
  // 账户id
  userID    String
  // 原始令牌
  token     String    @id @default(uuid())
  // 创建时间
  createAt  DateTime  @default(now())
  // 过期时间
  expiresAt DateTime?
}

model Product {
  user         User           @relation(fields: [authorID], references: [userID])
  // 作者id
  authorID     String
  // 产品id
  productID    String         @id
  // 名称
  name         String
  avatarURL    String?
  // 描述
  summary      String?
  // 价格
  price        Decimal        @db.Decimal(10, 2)
  OrderDetails OrderDetails[]
  Card         Card[]
  Item         Item[]
}

model Order {
  // 订单号
  orderID      Int           @id @default(autoincrement())
  // 下单时间
  orderDate    DateTime      @default(now())
  user         User          @relation(fields: [userID], references: [userID])
  // 下单账户
  userID       String
  // 非下单账户的收货id
  toID         String?
  // 状态
  status       String        @default("pending")
  // 总金额
  total        Decimal       @db.Decimal(10, 2)
  OrderDetails OrderDetails?
}

model OrderDetails {
  order       Order   @relation(fields: [orderID], references: [orderID])
  // 订单号
  orderID     Int     @id
  product     Product @relation(fields: [productID], references: [productID])
  // 商品号
  productID   String
  // 商品数据
  productData String?
  // 数量
  count       Int     @default(1)
}